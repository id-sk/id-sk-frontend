{"version":3,"file":"details.mjs","sources":["../../../../src/govuk/components/details/details.mjs"],"sourcesContent":["/**\n * JavaScript 'polyfill' for HTML5's <details> and <summary> elements\n * and 'shim' to add accessiblity enhancements for all browsers\n *\n * http://caniuse.com/#feat=details\n */\nimport { generateUniqueID } from '../../common/index.mjs'\n\nvar KEY_ENTER = 13\nvar KEY_SPACE = 32\n\n/**\n * Details component\n *\n * @class\n * @param {Element} $module - HTML element to use for details\n */\nfunction Details ($module) {\n  if (!($module instanceof HTMLElement)) {\n    return this\n  }\n\n  /** @deprecated Will be made private in v5.0 */\n  this.$module = $module\n\n  /** @deprecated Will be made private in v5.0 */\n  this.$summary = null\n\n  /** @deprecated Will be made private in v5.0 */\n  this.$content = null\n}\n\n/**\n * Initialise component\n */\nDetails.prototype.init = function () {\n  // Check that required elements are present\n  if (!this.$module) {\n    return\n  }\n\n  // If there is native details support, we want to avoid running code to polyfill native behaviour.\n  var hasNativeDetails = 'HTMLDetailsElement' in window &&\n    this.$module instanceof HTMLDetailsElement\n\n  if (!hasNativeDetails) {\n    this.polyfillDetails()\n  }\n}\n\n/**\n * Polyfill component in older browsers\n *\n * @deprecated Will be made private in v5.0\n */\nDetails.prototype.polyfillDetails = function () {\n  var $module = this.$module\n\n  // Save shortcuts to the inner summary and content elements\n  var $summary = this.$summary = $module.getElementsByTagName('summary').item(0)\n  var $content = this.$content = $module.getElementsByTagName('div').item(0)\n\n  // If <details> doesn't have a <summary> and a <div> representing the content\n  // it means the required HTML structure is not met so the script will stop\n  if (!$summary || !$content) {\n    return\n  }\n\n  // If the content doesn't have an ID, assign it one now\n  // which we'll need for the summary's aria-controls assignment\n  if (!$content.id) {\n    $content.id = 'details-content-' + generateUniqueID()\n  }\n\n  // Add ARIA role=\"group\" to details\n  $module.setAttribute('role', 'group')\n\n  // Add role=button to summary\n  $summary.setAttribute('role', 'button')\n\n  // Add aria-controls\n  $summary.setAttribute('aria-controls', $content.id)\n\n  // Set tabIndex so the summary is keyboard accessible for non-native elements\n  //\n  // We have to use the camelcase `tabIndex` property as there is a bug in IE6/IE7 when we set the correct attribute lowercase:\n  // See http://web.archive.org/web/20170120194036/http://www.saliences.com/browserBugs/tabIndex.html for more information.\n  $summary.tabIndex = 0\n\n  // Detect initial open state\n  if (this.$module.hasAttribute('open')) {\n    $summary.setAttribute('aria-expanded', 'true')\n  } else {\n    $summary.setAttribute('aria-expanded', 'false')\n    $content.style.display = 'none'\n  }\n\n  // Bind an event to handle summary elements\n  this.polyfillHandleInputs(this.polyfillSetAttributes.bind(this))\n}\n\n/**\n * Define a statechange function that updates aria-expanded and style.display\n *\n * @deprecated Will be made private in v5.0\n * @returns {boolean} Returns true\n */\nDetails.prototype.polyfillSetAttributes = function () {\n  if (this.$module.hasAttribute('open')) {\n    this.$module.removeAttribute('open')\n    this.$summary.setAttribute('aria-expanded', 'false')\n    this.$content.style.display = 'none'\n  } else {\n    this.$module.setAttribute('open', 'open')\n    this.$summary.setAttribute('aria-expanded', 'true')\n    this.$content.style.display = ''\n  }\n\n  return true\n}\n\n/**\n * Handle cross-modal click events\n *\n * @deprecated Will be made private in v5.0\n * @param {(event: UIEvent) => void} callback - function\n */\nDetails.prototype.polyfillHandleInputs = function (callback) {\n  this.$summary.addEventListener('keypress', function (event) {\n    var $target = event.target\n    // When the key gets pressed - check if it is enter or space\n    if (event.keyCode === KEY_ENTER || event.keyCode === KEY_SPACE) {\n      if ($target instanceof HTMLElement && $target.nodeName.toLowerCase() === 'summary') {\n        // Prevent space from scrolling the page\n        // and enter from submitting a form\n        event.preventDefault()\n        // Click to let the click event do all the necessary action\n        if ($target.click) {\n          $target.click()\n        } else {\n          // except Safari 5.1 and under don't support .click() here\n          callback(event)\n        }\n      }\n    }\n  })\n\n  // Prevent keyup to prevent clicking twice in Firefox when using space key\n  this.$summary.addEventListener('keyup', function (event) {\n    var $target = event.target\n    if (event.keyCode === KEY_SPACE) {\n      if ($target instanceof HTMLElement && $target.nodeName.toLowerCase() === 'summary') {\n        event.preventDefault()\n      }\n    }\n  })\n\n  this.$summary.addEventListener('click', callback)\n}\n\nexport default Details\n"],"names":[],"mappings":"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"}